---
kind: DatasetSnapshot
version: 1
content:
  name: coinpaprika.tickers.eth-usd.24h-historic
  kind: root
  metadata:
    - kind: setPollingSource
      fetch:
        kind: url
        url: "https://api.coinpaprika.com/v1/tickers/eth-ethereum/historical\
          ?start=2010-01-01
          &end=2022-05-25
          &interval=1d
          &limit=5000"
      prepare:
        - kind: pipe
          command:
            - "jq"
            - "-c"
            - ".[]"
      read:
        kind: jsonLines
        schema:
          - timestamp TIMESTAMP
          - price FLOAT
          - volume_24h FLOAT
          - market_cap FLOAT
      preprocess:
        kind: sql
        engine: spark
        query: |
          select
            timestamp as event_time,
            "eth" as from_symbol,
            "usd" as to_symbol,
            price,
            volume_24h,
            market_cap
          from input
      merge:
        kind: ledger
        primaryKey:
          - event_time
          - from_symbol
          - to_symbol
